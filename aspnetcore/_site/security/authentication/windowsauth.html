<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Configure Windows Authentication in ASP.NET Core </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Configure Windows Authentication in ASP.NET Core ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="security/authentication/windowsauth">
<h1 id="configure-windows-authentication-in-aspnet-core">Configure Windows Authentication in ASP.NET Core</h1>

<p>By <a href="https://ardalis.com">Steve Smith</a></p>
<p>Windows authentication can be configured for ASP.NET Core apps hosted with IIS or WebListener.</p>
<h2 id="what-is-windows-authentication">What is Windows authentication</h2>
<p>Windows authentication relies on the operating system to authenticate users of ASP.NET Core apps. You can use Windows authentication when your server runs on a corporate network using Active Directory domain identities or other Windows accounts to identify users. Windows authentication is a secure form of authentication best suited to intranet environments where users, client applications, and web servers belong to the same Windows domain.</p>
<p><a href="https://docs.microsoft.com/iis/configuration/system.webServer/security/authentication/windowsAuthentication/">Learn more about Windows Authentication and installing it for IIS</a>.</p>
<h2 id="enabling-windows-authentication-in-an-aspnet-core-application">Enabling Windows authentication in an ASP.NET Core application</h2>
<p>The Visual Studio Web Application template can be configured to support Windows authentication.</p>
<h3 id="using-the-windows-authentication-app-template">Using the Windows authentication app template</h3>
<p>In Visual Studio:</p>
<ul>
<li>Create a new ASP.NET Core Web Application. </li>
<li>Select Web Application from the list of templates.</li>
<li>Select the Change Authentication button and select <strong>Windows Authentication</strong>. </li>
</ul>
<p>Run the app. The username appears in the top right of the app.</p>
<p><img src="windowsauth/_static/browser-screenshot.png" alt="Windows Authentication Browser Screenshot"></p>
<p>For development work using IIS Express, the template provides all the configuration necessary to use Windows authentication. The next section shows how to configure an ASP.NET Core app manually for Windows authentication.</p>
<h3 id="visual-studio-settings-for-windows-and-anonymous-authentication">Visual Studio settings for Windows and anonymous authentication</h3>
<p>The Visual Studio properties page, debug tab provides check boxes for Windows authentication and anonymous authentication.</p>
<p><img src="windowsauth/_static/vs-auth-property-menu.png" alt="Windows Authentication Browser Screenshot"></p>
<p>You can also configure these properties in the <code>launchSettings.json</code> file:</p>
<pre><code class="lang-json">{
  &quot;iisSettings&quot;: {
    &quot;windowsAuthentication&quot;: true,
    &quot;anonymousAuthentication&quot;: false,
    &quot;iisExpress&quot;: {
      &quot;applicationUrl&quot;: &quot;http://localhost:52171/&quot;,
      &quot;sslPort&quot;: 0
    }
  } // additional options trimmed
}
</code></pre><h2 id="enabling-windows-authentication-with-iis">Enabling Windows Authentication with IIS</h2>
<p>IIS uses the <a class="xref" href="../../fundamentals/servers/aspnet-core-module.html">ASP.NET Core Module</a> (ANCM) to host ASP.NET Core apps. The ANCM flows Windows authentication to IIS by default. Configuration of Windows authentication is done within IIS, not the application project. The following sections show how to use IIS Manager to configure an ASP.NET Core app to use Windows authentication:</p>
<h3 id="create-a-new-iis-site">Create a new IIS site</h3>
<p>Specify a name and folder and allow it to create a new application pool.</p>
<h3 id="customize-authentication">Customize Authentication</h3>
<p>Open the Authentication menu for the site.</p>
<p><img src="windowsauth/_static/iis-authentication-menu.png" alt="IIS Authentication Menu"></p>
<p>Disable Anonymous Authentication and enable Windows Authentication.</p>
<p><img src="windowsauth/_static/iis-auth-settings.png" alt="IIS Authentication Settings"></p>
<h3 id="publish-your-project-to-the-iis-site-folder">Publish your project to the IIS site folder</h3>
<p>Using Visual Studio or the .NET Core CLI, <em>publish</em> your app to the destination folder.</p>
<p><img src="windowsauth/_static/vs-publish-app.png" alt="Visual Studio Publish Dialog"></p>
<p>Learn more about <a class="xref" href="../../publishing/iis.html">publishing to IIS</a>.</p>
<p>Launch the app to verify Windows authentication is working.</p>
<h2 id="enabling-windows-authentication-with-weblistener">Enabling Windows authentication with WebListener</h2>
<p>Although Kestrel doesn&#39;t support Windows authentication, you can use <a class="xref" href="../../fundamentals/servers/weblistener.html">WebListener</a> to support self-hosted scenarios on Windows. The following example configures the app&#39;s web host to use WebListener with Windows authentication:</p>
<pre><code class="lang-csharp">public class Program
{
    public static void Main(string[] args)
    {
        var host = new WebHostBuilder()
            .UseWebListener(options =&gt;
            {
                options.ListenerSettings.Authentication.Schemes = 
                    AuthenticationSchemes.Negotiate | AuthenticationSchemes.NTLM;
                options.ListenerSettings.Authentication.AllowAnonymous = false;
            })
            .UseContentRoot(Directory.GetCurrentDirectory())
            .UseStartup&lt;Startup&gt;()
            .Build();

        host.Run();
    }
}
</code></pre><h2 id="working-with-windows-authentication">Working with Windows authentication</h2>
<p>If your app uses Windows authentication and anonymous access, you can use the <code>[Authorize]</code> and <code>[AllowAnonymous]</code> attributes. Apps that do not have anonymous enabled do not require <code>[Authorize]</code>; the  app is treated as requiring authentication, anonymous requests are rejected. Note, if the IIS site is configured <strong>not</strong> to allow anonymous access, the <code>[AllowAnonymous]</code> attribute does <strong>not</strong> allow anonymous requests. The <code>[AllowAnonymous]</code> attribute overrides <code>[Authorize]</code> attribute usage within apps that allow anonymous access.</p>
<h3 id="impersonation">Impersonation</h3>
<p>ASP.NET Core does not implement impersonation. Apps run with the application identity for all requests, using app pool or process identity. If you need to explicitly perform an action on behalf of a user, use <code>WindowsIdentity.RunImpersonated</code>. Run a single action in this context and then close the context. Note that <code>RunImpersonated</code> does not support async and should not be used for complex scenarios. For example, wrapping entire requests or middleware chains is not supported or recommended.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/security/authentication/windowsauth.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
