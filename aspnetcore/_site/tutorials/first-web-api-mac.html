<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Create a Web API with ASP.NET Core and Visual Studio for Mac </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Create a Web API with ASP.NET Core and Visual Studio for Mac ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/first-web-api-mac">
<h1 id="create-a-web-api-with-aspnet-core-mvc-and-visual-studio-for-mac">Create a Web API with ASP.NET Core MVC and Visual Studio for Mac</h1>

<p>By <a href="https://twitter.com/RickAndMSFT">Rick Anderson</a> and <a href="https://github.com/mikewasson">Mike Wasson</a></p>
<p>In this tutorial, you’ll build a web API for managing a list of &quot;to-do&quot; items. You won’t build a UI.</p>
<p>There are 3 versions of this tutorial:</p>
<ul>
<li>macOS: Web API with Visual Studio for Mac (This tutorial)</li>
<li>Windows: <a class="xref" href="first-web-api.html">Web API with Visual Studio for Windows</a></li>
<li>macOS, Linux, Windows: <a class="xref" href="web-api-vsc.html">Web API with Visual Studio Code</a></li>
</ul>
<!-- WARNING: The code AND images in this doc are used by uid: tutorials/web-api-vsc, tutorials/first-web-api-mac and tutorials/first-web-api. If you change any code/images in this tutorial, update uid: tutorials/web-api-vsc -->
<h2 id="overview">Overview</h2>
<p>Here is the API that you’ll create:</p>
<table>
<thead>
<tr>
<th>API</th>
<th>Description</th>
<th>Request body</th>
<th>Response body</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET /api/todo</td>
<td>Get all to-do items</td>
<td>None</td>
<td>Array of to-do items</td>
</tr>
<tr>
<td>GET /api/todo/{id}</td>
<td>Get an item by ID</td>
<td>None</td>
<td>To-do item</td>
</tr>
<tr>
<td>POST /api/todo</td>
<td>Add a new item</td>
<td>To-do item</td>
<td>To-do item</td>
</tr>
<tr>
<td>PUT /api/todo/{id}</td>
<td>Update an existing item &nbsp;</td>
<td>To-do item</td>
<td>None</td>
</tr>
<tr>
<td>DELETE /api/todo/{id}  &nbsp;  &nbsp;</td>
<td>Delete an item &nbsp;  &nbsp;</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>The following diagram shows the basic design of the app.</p>
<p><img src="first-web-api/_static/architecture.png" alt="The client is represented by a box on the left and submits a request and receives a response from the application, a box drawn on the right. Within the application box, three boxes represent the controller, the model, and the data access layer. The request comes into the application&#39;s controller, and read/write operations occur between the controller and the data access layer. The model is serialized and returned to the client in the response."></p>
<ul>
<li><p>The client is whatever consumes the web API (mobile app, browser, etc). We aren’t writing a client in this tutorial. We&#39;ll use <a href="https://www.getpostman.com/">Postman</a> or <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/curl.1.html">curl</a> to test the app.</p>
</li>
<li><p>A <em>model</em> is an object that represents the data in your application. In this case, the only model is a to-do item. Models are represented as C# classes, also know as <strong>P</strong>lain <strong>O</strong>ld <strong>C</strong># <strong>O</strong>bject (POCOs).</p>
</li>
<li><p>A <em>controller</em> is an object that handles HTTP requests and creates the HTTP response. This app will have a single controller.</p>
</li>
<li><p>To keep the tutorial simple, the app doesn’t use a persistent database. The sample app stores to-do items in an in-memory database.</p>
</li>
</ul>
<ul>
<li>See <a class="xref" href="first-mvc-app-xplat/index.html">Introduction to ASP.NET Core MVC on Mac or Linux</a> for an example that uses a persistent database.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>Install the following:</p>
<ul>
<li><a href="https://www.microsoft.com/net/core#macos">.NET Core SDK</a>  </li>
<li><a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac</a></li>
</ul>
<h2 id="create-the-project">Create the project</h2>
<p>From Visual Studio, select <strong>File &gt; New Solution</strong>.</p>
<p><img src="first-web-api-mac/_static/sln.png" alt="macOS New solution"></p>
<p>Select <strong>.NET Core App &gt;  ASP.NET Core Web API &gt; Next</strong>.</p>
<p><img src="first-web-api-mac/_static/1.png" alt="macOS New project dialog"></p>
<p>Enter <strong>TodoApi</strong> for the <strong>Project Name</strong>, and then select Create.</p>
<p><img src="first-web-api-mac/_static/2.png" alt="config dialog"></p>
<h3 id="launch-the-app">Launch the app</h3>
<p>In Visual Studio, select <strong>Run &gt; Start With Debugging</strong> to launch the app. Visual Studio launches a browser and navigates to <code>http://localhost:5000</code>. You get an HTTP 404 (Not Found) error.  Change the URL to <code>http://localhost:port/api/values</code>. The <code>ValuesController</code> data will be displayed:</p>
<pre><code>[&quot;value1&quot;,&quot;value2&quot;]
</code></pre><h3 id="add-support-for-entity-framework-core">Add support for Entity Framework Core</h3>
<p>Install the <a href="https://docs.microsoft.com/ef/core/providers/in-memory/">Entity Framework Core InMemory</a> database provider. This database provider allows Entity Framework Core to be used with an in-memory database.</p>
<ul>
<li><p>From the <strong>Project</strong> menu, select <strong>Add NuGet Packages</strong>. </p>
<ul>
<li>Alternately, you can right-click <strong>Dependencies</strong>, and then select <strong>Add Packages</strong>.</li>
</ul>
</li>
<li><p>Enter <code>EntityFrameworkCore.InMemory</code> in the search box.</p>
</li>
<li>Select <code>Microsoft.EntityFrameworkCore.InMemory</code>, and then select <strong>Add Package</strong>.</li>
</ul>
<h3 id="add-a-model-class">Add a model class</h3>
<p>A model is an object that represents the data in your application. In this case, the only model is a to-do item.</p>
<p>Add a folder named <em>Models</em>. In Solution Explorer, right-click the project. Select <strong>Add</strong> &gt; <strong>New Folder</strong>. Name the folder <em>Models</em>.</p>
<p><img src="first-web-api-mac/_static/folder.png" alt="new folder"></p>
<p>Note: You can put model classes anywhere in your project, but the <em>Models</em> folder is used by convention.</p>
<p>Add a <code>TodoItem</code> class. Right-click the <em>Models</em> folder and select <strong>Add &gt; New File &gt; General &gt; Empty Class</strong>. Name the class <code>TodoItem</code>, and then select <strong>New</strong>.</p>
<p>Replace the generated code with:</p>
<pre><code class="lang-csharp" name="Main">namespace TodoApi.Models
{
    public class TodoItem
    {
        public long Id { get; set; }
        public string Name { get; set; }
        public bool IsComplete { get; set; }
    }
}
</code></pre><p>The database generates the <code>Id</code> when a <code>TodoItem</code> is created.</p>
<h3 id="create-the-database-context">Create the database context</h3>
<p>The <em>database context</em> is the main class that coordinates Entity Framework functionality for a given data model. You create this class by deriving from the <code>Microsoft.EntityFrameworkCore.DbContext</code> class.</p>
<p>Add a <code>TodoContext</code> class to the <em>Models</em> folder.</p>
<pre><code class="lang-csharp" name="Main">using Microsoft.EntityFrameworkCore;

namespace TodoApi.Models
{
    public class TodoContext : DbContext
    {
        public TodoContext(DbContextOptions&lt;TodoContext&gt; options)
            : base(options)
        {
        }

        public DbSet&lt;TodoItem&gt; TodoItems { get; set; }

    }
}
</code></pre><h2 id="register-the-database-context">Register the database context</h2>
<p>In order to inject the database context into the controller, we need to register it with the <a class="xref" href="../fundamentals/dependency-injection.html">dependency injection</a> container. Register the database context with the service container using the built-in support for <a class="xref" href="../fundamentals/dependency-injection.html">dependency injection</a>. Replace the contents of the <em>Startup.cs</em> file with the following:</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="2,4,12">using Microsoft.AspNetCore.Builder;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using TodoApi.Models;

namespace TodoApi
{
    public class Startup
    {       
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddDbContext&lt;TodoContext&gt;(opt =&gt; opt.UseInMemoryDatabase(&quot;TodoList&quot;));
            services.AddMvc();
        }

        public void Configure(IApplicationBuilder app)
        {
            app.UseMvc();
        }
    }
}
</code></pre><p>The preceding code:</p>
<ul>
<li>Removes the code we&#39;re not using.</li>
<li>Specifies an in-memory database is injected into the service container.</li>
</ul>
<h2 id="add-a-controller">Add a controller</h2>
<p>In Solution Explorer, in the <em>Controllers</em> folder, add the class <code>TodoController</code>.</p>
<p>Replace the generated code with the following (and add closing braces):</p>
<pre><code class="lang-csharp" name="Main">using System.Collections.Generic;
using Microsoft.AspNetCore.Mvc;
using TodoApi.Models;
using System.Linq;

namespace TodoApi.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    public class TodoController : Controller
    {
        private readonly TodoContext _context;

        public TodoController(TodoContext context)
        {
            _context = context;

            if (_context.TodoItems.Count() == 0)
            {
                _context.TodoItems.Add(new TodoItem { Name = &quot;Item1&quot; });
                _context.SaveChanges();
            }
        }       
    }
}
</code></pre><p>The preceding code:</p>
<ul>
<li>Defines an empty controller class. In the next sections, we&#39;ll add methods to implement the API.</li>
<li>The constructor uses <a class="xref" href="../fundamentals/dependency-injection.html">Dependency Injection</a> to inject the database context (<code>TodoContext</code>) into the controller. The database context is used in each of the <a href="https://wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> methods in the controller.</li>
<li>The constructor adds an item to the in-memory database if one doesn&#39;t exist.</li>
</ul>
<h2 id="getting-to-do-items">Getting to-do items</h2>
<p>To get to-do items, add the following methods to the <code>TodoController</code> class.</p>
<pre><code class="lang-csharp" name="Main">[HttpGet]
public IEnumerable&lt;TodoItem&gt; GetAll()
{
    return _context.TodoItems.ToList();
}

[HttpGet(&quot;{id}&quot;, Name = &quot;GetTodo&quot;)]
public IActionResult GetById(long id)
{
    var item = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);
    if (item == null)
    {
        return NotFound();
    }
    return new ObjectResult(item);
}
</code></pre><p>These methods implement the two GET methods:</p>
<ul>
<li><code>GET /api/todo</code></li>
<li><code>GET /api/todo/{id}</code></li>
</ul>
<p>Here is an example HTTP response for the <code>GetAll</code> method:</p>
<pre><code>HTTP/1.1 200 OK
   Content-Type: application/json; charset=utf-8
   Server: Microsoft-IIS/10.0
   Date: Thu, 18 Jun 2015 20:51:10 GMT
   Content-Length: 82

   [{&quot;Key&quot;:&quot;1&quot;, &quot;Name&quot;:&quot;Item1&quot;,&quot;IsComplete&quot;:false}]
</code></pre><p>Later in the tutorial I&#39;ll show how you can view the HTTP response using <a href="https://www.getpostman.com/">Postman</a> or <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/curl.1.html">curl</a>.</p>
<h3 id="routing-and-url-paths">Routing and URL paths</h3>
<p>The <code>[HttpGet]</code> attribute specifies an HTTP GET method. The URL path for each method is constructed as follows:</p>
<ul>
<li>Take the template string in the controller’s route attribute:</li>
</ul>
<pre><code class="lang-csharp" name="Main" highlight-lines="3">namespace TodoApi.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    public class TodoController : Controller
    {
        private readonly TodoContext _context;
</code></pre><ul>
<li>Replace &quot;[Controller]&quot; with the name of the controller, which is the controller class name minus the &quot;Controller&quot; suffix. For this sample, the controller class name is <strong>Todo</strong>Controller and the root name is &quot;todo&quot;. ASP.NET Core <a class="xref" href="../mvc/controllers/routing.html">routing</a> is not case sensitive.</li>
<li>If the <code>[HttpGet]</code> attribute has a route template (such as <code>[HttpGet(&quot;/products&quot;)]</code>, append that to the path. This sample doesn&#39;t use a template. See <a class="xref" href="../mvc/controllers/routing.html#attribute-routing-with-httpverb-attributes">Attribute routing with Http[Verb] attributes</a> for more information.</li>
</ul>
<p>In the <code>GetById</code> method:</p>
<pre><code class="lang-csharp">[HttpGet(&quot;{id}&quot;, Name = &quot;GetTodo&quot;)]
public IActionResult GetById(long id)
</code></pre><p><code>&quot;{id}&quot;</code> is a placeholder variable for the ID of the <code>todo</code> item. When <code>GetById</code> is invoked, it assigns the value of &quot;{id}&quot; in the URL to the method&#39;s <code>id</code> parameter.</p>
<p><code>Name = &quot;GetTodo&quot;</code> creates a named route and allows you to link to this route in an HTTP Response. I&#39;ll explain it with an example later. See <a class="xref" href="../mvc/controllers/routing.html">Routing to Controller Actions</a> for detailed information.</p>
<h3 id="return-values">Return values</h3>
<p>The <code>GetAll</code> method returns an <code>IEnumerable</code>. MVC automatically serializes the object to <a href="http://www.json.org/">JSON</a> and writes the JSON into the body of the response message. The response code for this method is 200, assuming there are no unhandled exceptions. (Unhandled exceptions are translated into 5xx errors.)</p>
<p>In contrast, the <code>GetById</code> method returns the more general <code>IActionResult</code> type, which represents a wide range of return types. <code>GetById</code> has two different return types:</p>
<ul>
<li><p>If no item matches the requested ID, the method returns a 404 error.  This is done by returning <code>NotFound</code>.</p>
</li>
<li><p>Otherwise, the method returns 200 with a JSON response body. This is done by returning an <code>ObjectResult</code></p>
</li>
</ul>
<h3 id="launch-the-app">Launch the app</h3>
<p>In Visual Studio, select <strong>Run &gt; Start With Debugging</strong> to launch the app. Visual Studio launches a browser and navigates to <code>http://localhost:port</code>, where <em>port</em> is a randomly chosen port number. You get an HTTP 404 (Not Found) error.  Change the URL to <code>http://localhost:port/api/values</code>. The <code>ValuesController</code> data will be displayed:</p>
<pre><code>[&quot;value1&quot;,&quot;value2&quot;]
</code></pre><p>Navigate to the <code>Todo</code> controller at<code>http://localhost:port/api/todo</code>:</p>
<pre><code>[{&quot;key&quot;:1,&quot;name&quot;:&quot;Item1&quot;,&quot;isComplete&quot;:false}]
</code></pre><h2 id="implement-the-other-crud-operations">Implement the other CRUD operations</h2>
<p>We&#39;ll add <code>Create</code>, <code>Update</code>, and <code>Delete</code> methods to the controller. These are variations on a theme, so I&#39;ll just show the code and highlight the main differences. Build the project after adding or changing code.</p>
<h3 id="create">Create</h3>
<pre><code class="lang-csharp" name="Main">[HttpPost]
public IActionResult Create([FromBody] TodoItem item)
{
    if (item == null)
    {
        return BadRequest();
    }

    _context.TodoItems.Add(item);
    _context.SaveChanges();

    return CreatedAtRoute(&quot;GetTodo&quot;, new { id = item.Id }, item);
}
</code></pre><p>This is an HTTP POST method, indicated by the <a href="/aspnet/core/api/microsoft.aspnetcore.mvc.httppostattribute"><code>[HttpPost]</code></a> attribute. The <a href="/aspnet/core/api/microsoft.aspnetcore.mvc.frombodyattribute"><code>[FromBody]</code></a> attribute tells MVC to get the value of the to-do item from the body of the HTTP request.</p>
<p>The <code>CreatedAtRoute</code> method returns a 201 response, which is the standard response for an HTTP POST method that creates a new resource on the server. <code>CreatedAtRoute</code> also adds a Location header to the response. The Location header specifies the URI of the newly created to-do item. See <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">10.2.2 201 Created</a>.</p>
<h3 id="use-postman-to-send-a-create-request">Use Postman to send a Create request</h3>
<ul>
<li>Start the app (<strong>Run &gt; Start With Debugging</strong>).</li>
<li>Start Postman.</li>
</ul>
<p><img src="first-web-api/_static/pmc.png" alt="Postman console"></p>
<ul>
<li>Set the HTTP method to <code>POST</code></li>
<li>Select the <strong>Body</strong> radio button</li>
<li>Select the <strong>raw</strong> radio button</li>
<li>Set the type to JSON</li>
<li>In the key-value editor, enter a Todo item such as</li>
</ul>
<pre><code class="lang-json">{
    &quot;name&quot;:&quot;walk dog&quot;,
    &quot;isComplete&quot;:true
}
</code></pre><ul>
<li><p>Select <strong>Send</strong></p>
</li>
<li><p>Select the Headers tab in the lower pane and copy the <strong>Location</strong> header:</p>
</li>
</ul>
<p><img src="first-web-api/_static/pmget.png" alt="Headers tab of the Postman console"></p>
<p>You can use the Location header URI to access the resource you just created. Recall the <code>GetById</code> method created the <code>&quot;GetTodo&quot;</code> named route:</p>
<pre><code class="lang-csharp">[HttpGet(&quot;{id}&quot;, Name = &quot;GetTodo&quot;)]
public IActionResult GetById(string id)
</code></pre><h3 id="update">Update</h3>
<pre><code class="lang-csharp" name="Main">[HttpPut(&quot;{id}&quot;)]
public IActionResult Update(long id, [FromBody] TodoItem item)
{
    if (item == null || item.Id != id)
    {
        return BadRequest();
    }

    var todo = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);
    if (todo == null)
    {
        return NotFound();
    }

    todo.IsComplete = item.IsComplete;
    todo.Name = item.Name;

    _context.TodoItems.Update(todo);
    _context.SaveChanges();
    return new NoContentResult();
}
</code></pre><p><code>Update</code> is similar to <code>Create</code>, but uses HTTP PUT. The response is <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">204 (No Content)</a>. According to the HTTP spec, a PUT request requires the client to send the entire updated entity, not just the deltas. To support partial updates, use HTTP PATCH.</p>
<pre><code class="lang-json">{
  &quot;key&quot;: 1,
  &quot;name&quot;: &quot;walk dog&quot;,
  &quot;isComplete&quot;: true
}
</code></pre><p><img src="first-web-api/_static/pmcput.png" alt="Postman console showing 204 (No Content) response"></p>
<h3 id="delete">Delete</h3>
<pre><code class="lang-csharp" name="Main">[HttpDelete(&quot;{id}&quot;)]
public IActionResult Delete(long id)
{
    var todo = _context.TodoItems.FirstOrDefault(t =&gt; t.Id == id);
    if (todo == null)
    {
        return NotFound();
    }

    _context.TodoItems.Remove(todo);
    _context.SaveChanges();
    return new NoContentResult();
}
</code></pre><p>The response is <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">204 (No Content)</a>.</p>
<p><img src="first-web-api/_static/pmd.png" alt="Postman console showing 204 (No Content) response"></p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li><a class="xref" href="../mvc/controllers/routing.html">Routing to Controller Actions</a></li>
<li>For information about deploying your API, see <a href="../publishing/index.html">Publishing and Deployment</a>.</li>
<li><a href="https://github.com/aspnet/Docs/tree/master/aspnetcore/tutorials/first-web-api/sample">View or download sample code</a></li>
<li><a href="https://www.getpostman.com/">Postman</a></li>
<li><a href="https://www.telerik.com/download/fiddler">Fiddler</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/tutorials/first-web-api-mac.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
