<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Adding a New Field to an ASP.NET Core app </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Adding a New Field to an ASP.NET Core app ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/first-mvc-app-xplat/new-field">
<h1 id="adding-a-new-field">Adding a new field</h1>

<p>By <a href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<p>This tutorial will add a new field to the <code>Movies</code> table. We&#39;ll drop the database and create a new one when we change the schema (add a new field). This workflow works well early in development when we don&#39;t have any production data to perserve.</p>
<p>Once your app is deployed and you have data that you need to perserve, you can&#39;t drop your DB when you need to change the schema. Entity Framework <a href="https://docs.microsoft.com/ef/core/get-started/aspnetcore/new-db">Code First Migrations</a> allows you to update your schema and migrate the database without losing data. Migrations is a popular feature when using SQL Server, but SQLlite does not support many migration schema operations, so only very simply migrations are possible. See <a href="https://docs.microsoft.com/ef/core/providers/sqlite/limitations">SQLite Limitations</a> for more information.</p>
<h2 id="adding-a-rating-property-to-the-movie-model">Adding a Rating Property to the Movie Model</h2>
<p>Open the <em>Models/Movie.cs</em> file and add a <code>Rating</code> property:</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="11">public class Movie
{
    public int ID { get; set; }
    public string Title { get; set; }

    [Display(Name = &quot;Release Date&quot;)]
    [DataType(DataType.Date)]
    public DateTime ReleaseDate { get; set; }
    public string Genre { get; set; }
    public decimal Price { get; set; }
    public string Rating { get; set; }
}
</code></pre><p>Because you&#39;ve added a new field to the <code>Movie</code> class, you also need to update the binding whitelist so this new property will be included. In <em>MoviesController.cs</em>, update the <code>[Bind]</code> attribute for both the <code>Create</code> and <code>Edit</code> action methods to include the <code>Rating</code> property:</p>
<pre><code class="lang-csharp">[Bind(&quot;ID,Title,ReleaseDate,Genre,Price,Rating&quot;)]
</code></pre><p>You also need to update the view templates in order to display, create, and edit the new <code>Rating</code> property in the browser view.</p>
<p>Edit the <em>/Views/Movies/Index.cshtml</em> file and add a <code>Rating</code> field:</p>
<pre><code class="lang-HTML" name="Main" highlight-lines="17,39">&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.movies[0].Title)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.movies[0].ReleaseDate)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.movies[0].Genre)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.movies[0].Price)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.movies[0].Rating)
            &lt;/th&gt;
            &lt;th&gt;&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        @foreach (var item in Model.movies)
        {
            &lt;tr&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Title)
                &lt;/td&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.ReleaseDate)
                &lt;/td&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Genre)
                &lt;/td&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Price)
                &lt;/td&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Rating)
                &lt;/td&gt;
                &lt;td&gt;
</code></pre><p>Update the <em>/Views/Movies/Create.cshtml</em> with a <code>Rating</code> field.</p>
<p>The app won&#39;t work until we update the DB to include the new field. If you run it now, you&#39;ll get the following <code>SqliteException</code>:</p>
<pre><code>SqliteException: SQLite Error 1: &#39;no such column: m.Rating&#39;.
</code></pre><p>You&#39;re seeing this error because the updated Movie model class is different than the schema of the Movie table of the existing database. (There&#39;s no <code>Rating</code> column in the database table.)</p>
<p>There are a few approaches to resolving the error:</p>
<ol>
<li><p>Drop the database and have the Entity Framework automatically re-create the database based on the new model class schema. With this approach, you lose existing data in the database — so you can&#39;t do this with a production database! Using an initializer to automatically seed a database with test data is often a productive way to develop an app.</p>
</li>
<li><p>Manually modify the schema of the existing database so that it matches the model classes. The advantage of this approach is that you keep your data. You can make this change either manually or by creating a database change script.</p>
</li>
<li><p>Use Code First Migrations to update the database schema.</p>
</li>
</ol>
<p>For this tutorial, we&#39;ll drop and re-create the database when the schema changes. Run the following command from a terminal to drop the db:</p>
<p><code>dotnet ef database drop</code></p>
<p>Update the <code>SeedData</code> class so that it provides a value for the new column. A sample change is shown below, but you&#39;ll want to make this change for each <code>new Movie</code>.</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="6">new Movie
{
    Title = &quot;When Harry Met Sally&quot;,
    ReleaseDate = DateTime.Parse(&quot;1989-1-11&quot;),
    Genre = &quot;Romantic Comedy&quot;,
    Rating = &quot;R&quot;,
    Price = 7.99M
},
</code></pre><p>Add the <code>Rating</code> field to the <code>Edit</code>, <code>Details</code>, and <code>Delete</code> view.</p>
<p>Run the app and verify you can create/edit/display movies with a <code>Rating</code> field. templates.</p>
<div class="step-by-step"><p><a href="search.html">Previous - Add search</a>
<a href="validation.html">Next - Add validation</a>  </p>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/tutorials/first-mvc-app-xplat/new-field.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
