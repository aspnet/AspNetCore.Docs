<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Getting Started with ASP.NET Core and Entity Framework 6 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Getting Started with ASP.NET Core and Entity Framework 6 ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="data/entity-framework-6">
<h1 id="getting-started-with-aspnet-core-and-entity-framework-6">Getting started with ASP.NET Core and Entity Framework 6</h1>

<p>By <a href="https://github.com/pgrudzien12">Paweł Grudzień</a>, <a href="https://github.com/DamienPontifex">Damien Pontifex</a>, and <a href="https://github.com/tdykstra">Tom Dykstra</a></p>
<p>This article shows how to use Entity Framework 6 in an ASP.NET Core application.</p>
<h2 id="overview">Overview</h2>
<p>To use Entity Framework 6, your project has to compile against .NET Framework, as Entity Framework 6 does not support .NET Core. If you need cross-platform features you will need to upgrade to <a href="https://docs.microsoft.com/ef/">Entity Framework Core</a>.</p>
<p>The recommended way to use Entity Framework 6 in an ASP.NET Core application is to put the EF6 context and model classes in a class library project that targets the full framework. Add a reference to the class library from the ASP.NET Core project. See the sample <a href="https://github.com/aspnet/Docs/tree/master/aspnetcore/data/entity-framework-6/sample/">Visual Studio solution with EF6 and ASP.NET Core projects</a>.</p>
<p>You can&#39;t put an EF6 context in an ASP.NET Core project because .NET Core projects don&#39;t support all of the functionality that EF6 commands such as <em>Enable-Migrations</em> require.</p>
<p>Regardless of project type in which you locate your EF6 context, only EF6 command-line tools work with an EF6 context. For example, <code>Scaffold-DbContext</code> is only available in Entity Framework Core. If you need to do reverse engineering of a database into an EF6 model, see <a href="https://msdn.microsoft.com/jj200620">Code First to an Existing Database</a>.</p>
<h2 id="reference-full-framework-and-ef6-in-the-aspnet-core-project">Reference full framework and EF6 in the ASP.NET Core project</h2>
<p>Your ASP.NET Core project needs to reference .NET framework and EF6. For example, the <em>.csproj</em> file of your ASP.NET Core project will look similar to the following example (only relevant parts of the file are shown).</p>
<pre><code class="lang-xml" highlight-lines="2">&lt;PropertyGroup&gt;
  &lt;TargetFramework&gt;net452&lt;/TargetFramework&gt;
  &lt;PreserveCompilationContext&gt;true&lt;/PreserveCompilationContext&gt;
  &lt;AssemblyName&gt;MVCCore&lt;/AssemblyName&gt;
  &lt;OutputType&gt;Exe&lt;/OutputType&gt;
  &lt;PackageId&gt;MVCCore&lt;/PackageId&gt;
&lt;/PropertyGroup&gt;
</code></pre><p>If you’re creating a new project, use the <strong>ASP.NET Core Web Application (.NET Framework)</strong> template.</p>
<h2 id="handle-connection-strings">Handle connection strings</h2>
<p>The EF6 command-line tools that you&#39;ll use in the EF6 class library project require a default constructor so they can instantiate the context. But you&#39;ll probably want to specify the connection string to use in the ASP.NET Core project, in which case your context constructor must have a parameter that lets you pass in the connection string. Here&#39;s an example.</p>
<pre><code class="lang-csharp">public class SchoolContext : DbContext
{
    public SchoolContext(string connString) : base(connString)
    {
    }
</code></pre><p>Since your EF6 context doesn&#39;t have a parameterless constructor, your EF6 project has to provide an implementation of <a href="https://msdn.microsoft.com/library/hh506876">IDbContextFactory</a>. The EF6 command-line tools will find and use that implementation so they can instantiate the context. Here&#39;s an example.</p>
<pre><code class="lang-csharp">public class SchoolContextFactory : IDbContextFactory&lt;SchoolContext&gt;
{
    public SchoolContext Create()
    {
        return new EF6.SchoolContext(&quot;Server=(localdb)\\mssqllocaldb;Database=EF6MVCCore;Trusted_Connection=True;MultipleActiveResultSets=true&quot;);
    }
}
</code></pre><p>In this sample code, the <code>IDbContextFactory</code> implementation passes in a hard-coded connection string. This is the connection string that the command-line tools will use. You&#39;ll want to implement a strategy to ensure that the class library uses the same connection string that the calling application uses. For example, you could get the value from an environment variable in both projects.</p>
<h2 id="set-up-dependency-injection-in-the-aspnet-core-project">Set up dependency injection in the ASP.NET Core project</h2>
<p>In the Core project&#39;s <em>Startup.cs</em> file, set up the EF6 context for dependency injection (DI) in <code>ConfigureServices</code>. EF context objects should be scoped for a per-request lifetime.</p>
<pre><code class="lang-csharp" highlight-lines="5">public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddMvc();
    services.AddScoped&lt;SchoolContext&gt;(_ =&gt; new SchoolContext(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));
}
</code></pre><p>You can then get an instance of the context in your controllers by using DI. The code is similar to what you&#39;d write for an EF Core context:</p>
<pre><code class="lang-csharp">public class StudentsController : Controller
{
    private readonly SchoolContext _context;

    public StudentsController(SchoolContext context)
    {
        _context = context;
    }
</code></pre><h2 id="sample-application">Sample application</h2>
<p>For a working sample application, see the <a href="https://github.com/aspnet/Docs/tree/master/aspnetcore/data/entity-framework-6/sample/">sample Visual Studio solution</a> that accompanies this article.</p>
<p>This sample can be created from scratch by the following steps in Visual Studio:</p>
<ul>
<li><p>Create a solution.</p>
</li>
<li><p><strong>Add New Project &gt; Web &gt; ASP.NET Core Web Application (.NET Framework)</strong></p>
</li>
<li><p><strong>Add New Project &gt; Windows Classic Desktop &gt; Class Library (.NET Framework)</strong></p>
</li>
<li><p>In <strong>Package Manager Console</strong> (PMC) for both projects, run the command <code>Install-Package Entityframework</code>.</p>
</li>
<li><p>In the class library project, create data model classes and a context class, and an implementation of <code>IDbContextFactory</code>.</p>
</li>
<li><p>In PMC for the class library project, run the commands <code>Enable-Migrations</code> and <code>Add-Migration Initial</code>. If you have set the ASP.NET Core project as the startup project, add <code>-StartupProjectName EF6</code> to these commands.</p>
</li>
<li><p>In the Core project, add a project reference to the class library project.</p>
</li>
<li><p>In the Core project, in <em>Startup.cs</em>, register the context for DI.</p>
</li>
<li><p>In the Core project, in <em>appsettings.json</em>, add the connection string.</p>
</li>
<li><p>In the Core project, add a controller and view(s) to verify that you can read and write data. (Note that ASP.NET Core MVC scaffolding won&#39;t work with the EF6 context referenced from the class library.)</p>
</li>
</ul>
<h2 id="summary">Summary</h2>
<p>This article has provided basic guidance for using Entity Framework 6 in an ASP.NET Core application.</p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://msdn.microsoft.com/data/jj680699.aspx">Entity Framework - Code-Based Configuration</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/data/entity-framework-6.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
