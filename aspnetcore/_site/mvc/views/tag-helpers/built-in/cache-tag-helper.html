<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Cache Tag Helper in ASP.NET Core MVC </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Cache Tag Helper in ASP.NET Core MVC ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="mvc/views/tag-helpers/builtin-th/cache-tag-helper">
<h1 id="cache-tag-helper-in-aspnet-core-mvc">Cache Tag Helper in ASP.NET Core MVC</h1>

<p>By <a href="http://peterkellner.net">Peter Kellner</a> </p>
<p>The  Cache Tag Helper provides the ability to dramatically improve the performance of your ASP.NET Core app by caching its content to the internal ASP.NET Core cache provider.</p>
<p>The Razor View Engine sets the default <code>expires-after</code> to twenty minutes.</p>
<p>The following Razor markup caches the date/time:</p>
<pre><code class="lang-cshtml">&lt;Cache&gt;@DateTime.Now&lt;Cache&gt;
</code></pre><p>The first request to the page that contains <code>CacheTagHelper</code> will display the current date/time. Additional requests will show the cached value until the cache expires (default 20 minutes) or is evicted by memory pressure.</p>
<p>You can set the cache duration with the following attributes:</p>
<h2 id="cache-tag-helper-attributes">Cache Tag Helper Attributes</h2>
<hr>
<h3 id="enabled">enabled</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Valid Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>&quot;true&quot; (default)</td>
</tr>
<tr>
<td></td>
<td>&quot;false&quot;</td>
</tr>
</tbody>
</table>
<p>Determines whether the content enclosed by the Cache Tag Helper is cached. The default is <code>true</code>.  If set to <code>false</code> this Cache Tag Helper will have no caching effect on the rendered output.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache enabled=&quot;true&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="expires-on">expires-on</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DateTimeOffset</td>
<td>&quot;@new DateTime(2025,1,29,17,02,0)&quot;</td>
</tr>
</tbody>
</table>
<p>Sets an absolute expiration date. The following example will cache the contents of the Cache Tag Helper until 5:02 PM on January 29, 2025.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache expires-on=&quot;@new DateTime(2025,1,29,17,02,0)&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="expires-after">expires-after</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>TimeSpan</td>
<td>&quot;@TimeSpan.FromSeconds(120)&quot;</td>
</tr>
</tbody>
</table>
<p>Sets the length of time from the first request time to cache the contents. </p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache expires-on=&quot;@TimeSpan.FromSeconds(120)&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="expires-sliding">expires-sliding</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>TimeSpan</td>
<td>&quot;@TimeSpan.FromSeconds(60)&quot;</td>
</tr>
</tbody>
</table>
<p>Sets the time that a cache entry should be evicted if it has not been accessed.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache expires-sliding=&quot;@TimeSpan.FromSeconds(60)&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="vary-by-header">vary-by-header</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>&quot;User-Agent&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;User-Agent,content-encoding&quot;</td>
</tr>
</tbody>
</table>
<p>Accepts a single header value or a comma-separated list of header values that trigger a cache refresh when they change. The following example monitors the header value <code>User-Agent</code>. The example will cache the content for every different <code>User-Agent</code> presented to the web server.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache vary-by-header=&quot;User-Agent&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="vary-by-query">vary-by-query</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>&quot;Make&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;Make,Model&quot;</td>
</tr>
</tbody>
</table>
<p>Accepts a single header value or a comma-separated list of header values that trigger a cache refresh when the header value changes. The following example looks at the values of <code>Make</code> and <code>Model</code>.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache vary-by-query=&quot;Make,Model&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="vary-by-route">vary-by-route</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>&quot;Make&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;Make,Model&quot;</td>
</tr>
</tbody>
</table>
<p>Accepts a single header value or a comma-separated list of header values that trigger a cache refresh when the route data parameter value(s) change. 
Example:</p>
<p><em>Startup.cs</em> </p>
<pre><code class="lang-csharp">routes.MapRoute(
    name: &quot;default&quot;,
    template: &quot;{controller=Home}/{action=Index}/{Make?}/{Model?}&quot;);
</code></pre><p><em>Index.cshtml</em></p>
<pre><code class="lang-cshtml">&lt;Cache vary-by-route=&quot;Make,Model&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="vary-by-cookie">vary-by-cookie</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>&quot;.AspNetCore.Identity.Application&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;.AspNetCore.Identity.Application,HairColor&quot;</td>
</tr>
</tbody>
</table>
<p>Accepts a single header value or a comma-separated list of header values that trigger a cache refresh when the header values(s) change. The following example looks at the cookie associated with ASP.NET Identity. When a user is authenticated the request cookie to be set which triggers a cache refresh.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache vary-by-cookie=&quot;.AspNetCore.Identity.Application&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="vary-by-user">vary-by-user</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>&quot;true&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;false&quot; (default)</td>
</tr>
</tbody>
</table>
<p>Specifies whether or not the cache should reset when the logged-in user (or Context Principal) changes. The current user is also known as the Request Context Principal and can be viewed in a Razor view by referencing <code>@User.Identity.Name</code>.</p>
<p>The following example looks at the current logged in user.  </p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache vary-by-user=&quot;true&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><p>Using this attribute maintains the contents in cache through a log-in and log-out cycle.  When using <code>vary-by-user=&quot;true&quot;</code>, a log-in and log-out action invalidates the cache for the authenticated user.  The cache is invalidated because a new unique cookie value is generated on login. Cache is maintained for the anonymous state when no cookie is present or has expired. This means if no user is logged in, the cache will be maintained.</p>
<hr>
<h3 id="vary-by">vary-by</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>&quot;@Model&quot;</td>
</tr>
</tbody>
</table>
<p>Allows for customization of what data gets cached. When the object referenced by the attribute&#39;s string value changes, the content of the Cache Tag Helper is updated. Often a string-concatenation of model values are assigned to this attribute.  Effectively, that means an update to any of the concatenated values invalidates the cache.</p>
<p>The following example assumes the controller method rendering the view sums the integer value of the two route parameters, <code>myParam1</code> and <code>myParam2</code>, and returns that as the single model property. When this sum changes, the content of the Cache Tag Helper is rendered and cached again.  </p>
<p>Example:</p>
<p>Action:</p>
<pre><code class="lang-csharp">public IActionResult Index(string myParam1,string myParam2,string myParam3)
{
    int num1;
    int num2;
    int.TryParse(myParam1, out num1);
    int.TryParse(myParam2, out num2);
    return View(viewName, num1 + num2);
}
</code></pre><p><em>Index.cshtml</em></p>
<pre><code class="lang-cshtml">&lt;Cache vary-by=&quot;@Model&quot;&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><hr>
<h3 id="priority">priority</h3>
<table>
<thead>
<tr>
<th>Attribute Type</th>
<th>Example Values</th>
</tr>
</thead>
<tbody>
<tr>
<td>CacheItemPriority</td>
<td>&quot;High&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;Low&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;NeverRemove&quot;</td>
</tr>
<tr>
<td></td>
<td>&quot;Normal&quot;</td>
</tr>
</tbody>
</table>
<p>Provides cache eviction guidance to the built-in cache provider. The web server will evict <code>Low</code> cache entries first when it&#39;s under memory pressure.</p>
<p>Example:</p>
<pre><code class="lang-cshtml">&lt;Cache priority=&quot;High&quot;&gt;
    Current Time Inside Cache Tag Helper: @DateTime.Now
&lt;/Cache&gt;
</code></pre><p>The <code>priority</code> attribute does not guarantee a specific level of cache retention. <code>CacheItemPriority</code> is only a suggestion. Setting this attribute to <code>NeverRemove</code> does not guarantee that the cache will always be retained. See <a href="#additional-resources">Additional Resources</a> for more information.</p>
<p>The Cache Tag Helper is dependent on the <a class="xref" href="../../../../performance/caching/memory.html">memory cache service</a>. The Cache Tag Helper adds the service if it has not been added.</p>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li><a class="xref" href="../../../../performance/caching/memory.html">In-memory caching in ASP.NET Core</a></li>
<li><a class="xref" href="../../../../security/authentication/identity.html">Introduction to Identity on ASP.NET Core</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/mvc/views/tag-helpers/built-in/cache-tag-helper.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
